<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title th:text="${title}">IoT Dashboard</title>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
        <link th:href="@{/css/theme.css}" rel="stylesheet">
    </head>
    <body>
        <div class="d-flex" id="wrapper">
            <!-- Sidebar -->
            <nav id="sidebar" class="bg-dark text-white">
                <div class="sidebar-header p-3">
                    <h4 class="mb-0">IoT Manager</h4>
                </div>
                <ul class="list-unstyled components">
                    <li class="active"><a href="#"><i class="fa fa-tachometer-alt me-2"></i> Bảng điều khiển</a></li>
                    <li><a href="#"><i class="fa fa-user me-2"></i> Thông tin cá nhân</a></li>
                    <li><a href="#"><i class="fa fa-map me-2"></i> Quản lý khu vực</a></li>
                    <li><a href="#"><i class="fa fa-chart-pie me-2"></i> Báo cáo</a></li>
                </ul>
            </nav>

            <!-- Page Content -->
            <div id="page-content-wrapper" class="w-100">
                <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
                    <div class="container-fluid">
                        <button class="btn btn-primary" id="menu-toggle"><i class="fa fa-bars"></i></button>
                        <div class="ms-auto">
                            <span class="me-3 text-muted">Xin chào, <strong>Demo User</strong></span>
                        </div>
                    </div>
                </nav>

                <div class="container-fluid px-4 mt-4">
                    <!-- Summary cards -->
                    <div class="row g-3">
                        <div class="col-lg-3 col-md-6">
                            <div class="card summary-card shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="me-3 icon-circle bg-primary"><i class="fa fa-layer-group text-white"></i></div>
                                        <div>
                                            <h6 class="mb-0">Tổng số khu vực quản lý</h6>
                                            <h3 class="mb-0">3</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="card summary-card shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="me-3 icon-circle bg-success"><i class="fa fa-microchip text-white"></i></div>
                                        <div>
                                            <h6 class="mb-0">Tổng số Node</h6>
                                            <h3 class="mb-0">5</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="card summary-card shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="me-3 icon-circle bg-warning"><i class="fa fa-toggle-on text-white"></i></div>
                                        <div>
                                            <h6 class="mb-0">Tổng số công tắc hoạt động</h6>
                                            <h3 class="mb-0">8</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <div class="card summary-card shadow-sm">
                                <div class="card-body">
                                    <div class="d-flex align-items-center">
                                        <div class="me-3 icon-circle bg-info"><i class="fa fa-thermometer-half text-white"></i></div>
                                        <div>
                                            <h6 class="mb-0">Tổng số cảm biến hoạt động</h6>
                                            <h3 class="mb-0">5</h3>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Rooms / Devices -->
                    <div class="row mt-4">
                        <div class="col-lg-8">
                            <div class="card mb-3">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <h5 class="mb-0">Tổng quan Khu vực: Ftown 2</h5>
                                    <div>
                                        <button class="btn btn-sm btn-danger me-2">Tiến hành điều khiển</button>
                                        <button class="btn btn-sm btn-secondary">Cấu hình</button>
                                    </div>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <canvas id="chartTemp" height="140"></canvas>
                                        </div>
                                        <div class="col-md-6">
                                            <canvas id="chartHumidity" height="140"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div id="rooms" class="row g-3">
                                <!-- Example room card -->
                                <div class="col-md-12">
                                    <div class="card room-card">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div>
                                                    <h5>Gs-Shop</h5>
                                                    <div class="text-muted">Nhiệt độ • 7/13/2019</div>
                                                    <h2 class="mt-3">32.8°C</h2>
                                                </div>
                                                <div class="d-flex align-items-center gap-2">
                                                    <div class="device-actions text-end">
                                                        <div class="device-row" data-device-id="1">
                                                            <span class="device-name">Công tắc 1</span>
                                                            <div class="btn-group btn-group-sm ms-2" role="group">
                                                                <button class="btn btn-outline-primary btn-control" data-device-id="1" data-action="toggle"><i class="fa fa-power-off"></i></button>
                                                                <button class="btn btn-outline-secondary btn-schedule" data-device-id="1"><i class="fa fa-clock"></i></button>
                                                            </div>
                                                        </div>
                                                        <div class="device-row" data-device-id="2">
                                                            <span class="device-name">Công tắc 2</span>
                                                            <div class="btn-group btn-group-sm ms-2" role="group">
                                                                <button class="btn btn-outline-primary btn-control" data-device-id="2" data-action="toggle"><i class="fa fa-power-off"></i></button>
                                                                <button class="btn btn-outline-secondary btn-schedule" data-device-id="2"><i class="fa fa-clock"></i></button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-4">
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h6>Thống kê nhanh</h6>
                                    <canvas id="pieSwitch" height="200"></canvas>
                                </div>
                            </div>
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h6>Thống kê khác</h6>
                                    <p class="text-muted">Chi tiết báo cáo, tổng thời gian hoạt động, ...</p>
                                </div>
                            </div>
                            <div class="card mb-3">
                                <div class="card-body">
                                    <h6>Simulator</h6>
                                    <div class="mb-2">
                                        <label class="form-label">Device ID</label>
                                        <input id="simDeviceId" class="form-control form-control-sm" value="1" />
                                    </div>
                                    <div class="mb-2">
                                        <label class="form-label">Room ID</label>
                                        <input id="simRoomId" class="form-control form-control-sm" value="1" />
                                    </div>
                                    <div class="mb-2">
                                        <label class="form-label">Type</label>
                                        <select id="simType" class="form-select form-select-sm"><option value="temperature">temperature</option><option value="switch">switch</option></select>
                                    </div>
                                    <div class="mb-2">
                                        <label class="form-label">Rate (msg/sec)</label>
                                        <input id="simRate" class="form-control form-control-sm" value="5" />
                                    </div>
                                    <div class="d-flex gap-2">
                                        <button id="simStart" class="btn btn-sm btn-success">Start</button>
                                        <button id="simStop" class="btn btn-sm btn-danger">Stop</button>
                                    </div>
                                    <div class="mt-2 text-muted small">Active simulation id: <span id="simId">-</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Libraries -->
        <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
        <script th:src="@{/js/dashboard.js}"></script>

        <script>
            // small UI toggle for sidebar
            document.getElementById('menu-toggle')?.addEventListener('click', function () {
                document.getElementById('sidebar').classList.toggle('collapsed');
            });

            // initialize sample charts
            document.addEventListener('DOMContentLoaded', function () {
                const ctx = document.getElementById('chartTemp');
                if (ctx) {
                    new Chart(ctx, { type: 'line', data: { labels: ['10:50','10:55','11:00','11:05'], datasets:[{label:'Nhiệt độ', data:[32.0,32.4,32.6,32.8], borderColor:'#007bff', backgroundColor:'rgba(0,123,255,0.06)'}] }, options:{responsive:true}});
                }
                const ctx2 = document.getElementById('chartHumidity');
                if (ctx2) {
                    new Chart(ctx2, { type: 'line', data: { labels: ['10:50','10:55','11:00','11:05'], datasets:[{label:'Độ ẩm', data:[68,67,67.5,66.8], borderColor:'#20c997', backgroundColor:'rgba(32,201,151,0.06)'}] }, options:{responsive:true}});
                }
                const pie = document.getElementById('pieSwitch');
                if (pie) {
                    new Chart(pie, { type:'doughnut', data:{labels:['Bật','Tắt'], datasets:[{data:[70,30], backgroundColor:['#20c997','#e9ecef']}], }, options:{responsive:true}});
                }
            });
        </script>
    </body>
</html>